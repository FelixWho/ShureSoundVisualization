<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>test</title>
</head>
<body>
<div>hi</div>
<script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
<script>
    navigator.mediaDevices.getUserMedia({audio: true, video: false}).then(async (stream) => {






        const context = new AudioContext();
        const source = context.createMediaStreamSource(stream);

        // server side
        await context.audioWorklet.addModule("audio-streamer.js");

        const streamerNode = new AudioWorkletNode(context, 'audio-streamer');

        console.log(streamerNode.bufferSize);

        function serverCallback(event) { // function that receives callback and updates DOM. NEEDS PROMISE??
            //console.log(event.target.responseText);
        }

        source.connect(streamerNode);

        // this line required for some stupid reason
        streamerNode.connect(context.destination);


        // client side analysis
        const analyzer = context.createAnalyser();

        analyzer.fftSize = 1024;
        analyzer.minDecibels = -100;
        analyzer.maxDecibels = -10;
        analyzer.smoothingTimeConstant = 0.50;

        function analyze() {
            let buf = new Float32Array(analyzer.frequencyBinCount);

            analyzer.getFloatFrequencyData(buf);

            const minFreq = 0;
            const maxFreq = context.sampleRate / 2;

            //console.log(buf);
        }

        setInterval(analyze, 100);

    });

</script>
</body>
</html>